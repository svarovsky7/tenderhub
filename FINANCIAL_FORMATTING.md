# 💰 Финансовое форматирование в TenderHub

## ✨ Улучшенное отображение финансовых данных

Добавлено профессиональное форматирование всех денежных сумм и количественных показателей в русском формате.

## 🎯 Что исправлено

### До:
```
1234567.89 → 1,234,567.89 ₽  (американский формат)
1000000 → 1,000,000 ₽
15.5 → 15.5 ₽
```

### После:
```
1234567.89 → 1 234 567,89 ₽  (российский стандарт)
1000000 → 1 000 000 ₽
15.5 → 15,50 ₽
0 → 0 ₽ (без десятичных знаков)
```

## 🛠 Технические детали

### Новые утилиты (`/src/utils/formatters.ts`)

#### `formatCurrency(amount, showDecimals?)`
**Назначение**: Форматирование денежных сумм
**Особенности**:
- Использует российские стандарты (`ru-RU`)
- Пробелы как разделители тысяч
- Запятая как разделитель дробной части
- Автоматическое определение необходимости десятичных знаков
- Обработка некорректных значений

```typescript
formatCurrency(1234567.89) → "1 234 567,89 ₽"
formatCurrency(1000000)    → "1 000 000 ₽"
formatCurrency(15.5)       → "15,50 ₽"
formatCurrency(null)       → "0,00 ₽"
```

#### `formatQuantity(quantity, maxDecimals?)`
**Назначение**: Форматирование количественных показателей
**Особенности**:
- Оптимальное количество десятичных знаков
- Российский формат чисел
- Без валютного символа

```typescript
formatQuantity(123.45) → "123,45"
formatQuantity(1000)   → "1 000"
formatQuantity(0.5)    → "0,5"
```

#### `formatUnitRate(unitRate)`
**Назначение**: Форматирование цены за единицу
**Особенности**:
- Всегда показывает два десятичных знака
- Полное форматирование с валютой

```typescript
formatUnitRate(150)    → "150,00 ₽"
formatUnitRate(99.9)   → "99,90 ₽"
```

## 📍 Места применения в ВОР

### 1. **Заголовок страницы**
```typescript
// Общая стоимость проекта
<span>{formatCurrency(totalProject)}</span>
// Результат: "2 450 780,50 ₽"
```

### 2. **Карточки позиций заказчика**
```typescript
// Стоимость позиции
<div>{formatCurrency(positionTotal)}</div>
// Результат: "156 750 ₽"

// Объем работ
<span>({formatQuantity(position.volume)} {position.unit})</span>
// Результат: "(120,5 м³)"
```

### 3. **Элементы BOQ (работы/материалы)**
```typescript
// Детализация расчета
<div>
  {formatQuantity(subItem.quantity)} {subItem.unit} × {formatUnitRate(subItem.unit_rate)}
</div>
// Результат: "25,5 м² × 1 250,00 ₽"

// Итоговая стоимость элемента
<span>{formatCurrency(subItem.total_amount)}</span>
// Результат: "31 875 ₽"
```

### 4. **Форма добавления элементов**
```typescript
// Предварительный расчет стоимости
<span>
  {formatCurrency(parseFloat(formData.quantity || '0') * parseFloat(formData.price || '0'))}
</span>
// Результат: "15 750,25 ₽"
```

## 🎨 Примеры в интерфейсе

### Заголовок ВОР:
```
┌─────────────────────────────────────────────┐
│ ВОР  Позиций: 15 | Элементов: 47    Итого: │
│                            2 450 780,50 ₽  │
└─────────────────────────────────────────────┘
```

### Карточка позиции:
```
┌─────────────────────────────────────────────┐
│ 1.1. Устройство фундамента (120,5 м³)      │
│ Прим: Включая армирование                   │
│                         3 поз.   156 750 ₽ │
└─────────────────────────────────────────────┘
```

### Элемент BOQ:
```
┌─────────────────────────────────────────────┐
│ Бетон М300                                  │
│ 🔧 25,5 м² × 1 250,00 ₽           31 875 ₽ │
└─────────────────────────────────────────────┘
```

## 🔧 Конфигурация

### Российские стандарты форматирования:
```typescript
numAmount.toLocaleString('ru-RU', {
  minimumFractionDigits: shouldShowDecimals ? 2 : 0,
  maximumFractionDigits: shouldShowDecimals ? 2 : 0,
});
```

### Автоматическое определение десятичных знаков:
```typescript
const shouldShowDecimals = showDecimals !== undefined 
  ? showDecimals 
  : (numAmount % 1 !== 0); // Показывать, если есть дробная часть
```

### Обработка ошибок:
```typescript
// Некорректные значения → "0,00 ₽"
// null, undefined, '', NaN, 'abc' → "0,00 ₽"
```

## ✅ Преимущества

1. **Соответствие стандартам**: Российские нормы форматирования чисел
2. **Профессиональный вид**: Аккуратное отображение финансовых данных  
3. **Консистентность**: Единый стиль по всему приложению
4. **Надежность**: Обработка некорректных данных
5. **Читаемость**: Легкое восприятие крупных сумм

## 🚀 Расширения

В будущем можно добавить:
- Форматирование с указанием валюты (USD, EUR)
- Настройки локали пользователя
- Сокращенные форматы (1,2К вместо 1 200)
- Цветовая индикация (красный для отрицательных значений)

## 📊 Тестирование

Создан тест-файл `test-formatters.js` для проверки корректности форматирования всех граничных случаев.