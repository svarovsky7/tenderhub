# üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ —Ä–æ–ª–µ–π –≤ TenderHub

## üìã –û–±–∑–æ—Ä

TenderHub –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ **Supabase Auth** —Å **5-—É—Ä–æ–≤–Ω–µ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π —Ä–æ–ª–µ–π**:

1. **Administrator** - –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º –∏ —Ñ—É–Ω–∫—Ü–∏—è–º
2. **moderator** - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é (–±–µ–∑ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏)
3. **engineer** - –î–æ—Å—Ç—É–ø –∫ —Ä–∞—Å—á–µ—Ç–∞–º –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –¥–∞–Ω–Ω—ã—Ö
4. **manager** - –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º –∞–Ω–∞–ª–∏–∑–∞ –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
5. **director** - –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–π –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –≤ Supabase

–û—Ç–∫—Ä–æ–π—Ç–µ **Supabase Dashboard** ‚Üí **SQL Editor** ‚Üí **New query**

https://supabase.com/dashboard/project/lkmgbizyyaaacetllbzr/sql/new

–ü—Ä–∏–º–µ–Ω—è–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ **—Å—Ç—Ä–æ–≥–æ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ**:

#### 1Ô∏è‚É£ –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (ENUM + —Ç–∞–±–ª–∏—Ü–∞ profiles)
```sql
-- –§–∞–π–ª: supabase/migrations/20251010_00_create_user_roles_foundation.sql
```
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞, –≤—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor –∏ –Ω–∞–∂–º–∏—Ç–µ **Run** (–∏–ª–∏ F5)

**–ß—Ç–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è**:
- ENUM —Ç–∏–ø `user_role` —Å 5 —Ä–æ–ª—è–º–∏
- –¢–∞–±–ª–∏—Ü–∞ `public.profiles` —Å –ø–æ–ª—è–º–∏ id, full_name, role, created_at, updated_at
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –¢—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è updated_at
- –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

#### 2Ô∏è‚É£ –§—É–Ω–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–æ–ª–µ–π
```sql
-- –§–∞–π–ª: supabase/migrations/20251010_01_create_update_role_function.sql
```
**–ß—Ç–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è**:
- –§—É–Ω–∫—Ü–∏—è `update_user_role(p_user_id, p_new_role)` –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–æ–ª–µ–π

#### 3Ô∏è‚É£ –¢—Ä–∏–≥–≥–µ—Ä –∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π
```sql
-- –§–∞–π–ª: supabase/migrations/20251010_update_profile_trigger.sql
```
**–ß—Ç–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è**:
- –¢—Ä–∏–≥–≥–µ—Ä `on_auth_user_created` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –§—É–Ω–∫—Ü–∏—è `create_profile_for_user()` - –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ user_metadata

#### 4Ô∏è‚É£ –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```sql
-- –§–∞–π–ª: supabase/migrations/20251010_create_get_all_users_function.sql
```
**–ß—Ç–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è**:
- –§—É–Ω–∫—Ü–∏—è `get_all_users()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ profiles –∏ auth.users

#### 5Ô∏è‚É£ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```sql
-- –§–∞–π–ª: supabase/migrations/20251010_sync_existing_users.sql
```
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**:
- –ü–µ—Ä–µ–Ω–æ—Å–∏—Ç –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ `auth.users` –≤ `profiles`
- –ú–∞–ø–ø–∏—Ç —Å—Ç–∞—Ä—ã–µ —Ä–æ–ª–∏ –Ω–∞ –Ω–æ–≤—ã–µ (Administrator ‚Üí Administrator, Engineer ‚Üí engineer, View-only ‚Üí manager)
- –í—ã–≤–æ–¥–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

---

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤ Supabase

#### –í–∞—Ä–∏–∞–Ω—Ç A: –û—Ç–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏) ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Supabase Dashboard** ‚Üí **Authentication** ‚Üí **Providers**
2. –ù–∞–π–¥–∏—Ç–µ **Email** –ø—Ä–æ–≤–∞–π–¥–µ—Ä
3. –í —Å–µ–∫—Ü–∏–∏ **Email confirmation** –≤—ã–±–µ—Ä–∏—Ç–µ **Disable email confirmation**
4. –ù–∞–∂–º–∏—Ç–µ **Save**

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å email —à–∞–±–ª–æ–Ω—ã (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Authentication** ‚Üí **Email Templates**
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —à–∞–±–ª–æ–Ω **Confirm signup**
3. –£–∫–∞–∂–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π **Site URL** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://yourdomain.com`)
4. Customize confirmation email text
5. –ù–∞–∂–º–∏—Ç–µ **Save**

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç email —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

---

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ RLS (Row Level Security)

‚ö†Ô∏è **–í–ê–ñ–ù–û**: –ü–æ –¥–∏–∑–∞–π–Ω—É TenderHub, RLS –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **–û–¢–ö–õ–Æ–ß–ï–ù**

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Database** ‚Üí **Tables** ‚Üí **profiles**
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ **Enable RLS** = **OFF**
3. –ï—Å–ª–∏ RLS –≤–∫–ª—é—á–µ–Ω - –≤—ã–∫–ª—é—á–∏—Ç–µ –µ–≥–æ

**–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É —Ä–æ–ª–µ–π –≤ `permissions.ts`

---

### –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: http://localhost:5174/admin/users
2. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ `auth.users`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ä–æ–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã

#### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/admin/users` –Ω–∞–∂–º–∏—Ç–µ **"–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"**
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:
   - Email: `test@example.com`
   - –ü–∞—Ä–æ–ª—å: –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤
   - –§–ò–û: `–¢–µ—Å—Ç–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å`
   - –†–æ–ª—å: –≤—ã–±–µ—Ä–∏—Ç–µ –ª—é–±—É—é
3. –ù–∞–∂–º–∏—Ç–µ **"–°–æ–∑–¥–∞—Ç—å"**
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ

#### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–∏

1. –í —Ç–∞–±–ª–∏—Ü–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞–π–¥–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –í –∫–æ–ª–æ–Ω–∫–µ **"–†–æ–ª—å"** –≤—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—É—é —Ä–æ–ª—å –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
3. –†–æ–ª—å –∏–∑–º–µ–Ω–∏—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
4. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

1. –í–æ–π–¥–∏—Ç–µ –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Å —Ä–æ–ª—å—é **engineer**
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å `/admin/users` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø –ó–ê–ü–†–ï–©–ï–ù
3. –û—Ç–∫—Ä–æ–π—Ç–µ `/libraries/materials-works` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø –†–ê–ó–†–ï–®–ï–ù

---

## üìä –ú–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

### –°—Ç—Ä–∞–Ω–∏—Ü—ã

| –°—Ç—Ä–∞–Ω–∏—Ü–∞ | Administrator | moderator | engineer | manager | director |
|----------|--------------|-----------|----------|---------|----------|
| `/dashboard` | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| `/boq` | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| `/tenders` | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| `/commercial-costs` | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå |
| `/cost-redistribution` | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| `/financial-indicators` | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| `/libraries/*` | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| `/construction-costs/*` | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| `/admin/users` | ‚úÖ | ‚ùå | ‚ùå | ‚ùå | ‚ùå |
| `/admin/nomenclatures` | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| `/admin/settings` | ‚úÖ | ‚ùå | ‚ùå | ‚ùå | ‚ùå |
| `/approvals` | ‚úÖ | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |

### –î–µ–π—Å—Ç–≤–∏—è

| –î–µ–π—Å—Ç–≤–∏–µ | Administrator | moderator | engineer | manager | director |
|----------|--------------|-----------|----------|---------|----------|
| –°–æ–∑–¥–∞–≤–∞—Ç—å —Ç–µ–Ω–¥–µ—Ä—ã | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–Ω–¥–µ—Ä—ã | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| –£–¥–∞–ª—è—Ç—å —Ç–µ–Ω–¥–µ—Ä—ã | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå |
| –°–æ–∑–¥–∞–≤–∞—Ç—å BOQ | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| –£–ø—Ä–∞–≤–ª—è—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| –£–ø—Ä–∞–≤–ª—è—Ç—å —Ä–∞–±–æ—Ç–∞–º–∏ | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –∑–∞—Ç—Ä–∞—Ç—ã | ‚úÖ | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ —Ç–µ–Ω–¥–µ—Ä–æ–≤ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå | ‚ùå |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ | ‚úÖ | ‚ùå | ‚ùå | ‚ùå | ‚ùå |

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `public.profiles`

```sql
CREATE TABLE public.profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  full_name TEXT NOT NULL,
  role user_role NOT NULL DEFAULT 'engineer',
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
```

### ENUM `user_role`

```sql
CREATE TYPE user_role AS ENUM (
  'Administrator',
  'moderator',
  'engineer',
  'manager',
  'director'
);
```

---

## üîß –§—É–Ω–∫—Ü–∏–∏ API

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (frontend)

```typescript
import { createUser } from '@/lib/supabase/api/users';

const { data, error } = await createUser(
  'user@example.com',
  'password123',
  '–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á',
  'engineer'
);
```

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç `supabase.auth.signUp()` —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏

### –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```typescript
import { getAllUsers } from '@/lib/supabase/api/users';

const { data, error } = await getAllUsers();
```

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç RPC —Ñ—É–Ω–∫—Ü–∏—é `get_all_users()`

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–∏

```typescript
import { updateUserRole } from '@/lib/supabase/api/users';

const { data, error } = await updateUserRole(userId, 'moderator');
```

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç RPC —Ñ—É–Ω–∫—Ü–∏—é `update_user_role(p_user_id, p_new_role)`

### –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```typescript
import { deleteUser } from '@/lib/supabase/api/users';

const { error } = await deleteUser(userId);
```

‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç admin –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π, —Å–µ–π—á–∞—Å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ anon –∫–ª—é—á

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ù–µ —É–¥–∞–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (403 Forbidden)

**–ü—Ä–∏—á–∏–Ω–∞**: –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `supabase.auth.admin.createUser()` —Å anon –∫–ª—é—á–æ–º

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—ã—á–Ω—ã–π `signUp()` –≤–º–µ—Å—Ç–æ admin API

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

**–ü—Ä–∏—á–∏–Ω–∞**: –ú–∏–≥—Ä–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∏–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ profiles –ø—É—Å—Ç–∞—è

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é `20251010_sync_existing_users.sql`

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –û—à–∏–±–∫–∞ "user_role does not exist"

**–ü—Ä–∏—á–∏–Ω–∞**: –ë–∞–∑–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–∏–º–µ–Ω–∏—Ç—å `20251010_00_create_user_roles_foundation.sql` –ü–ï–†–í–û–ô

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ù–µ —É–¥–∞–µ—Ç—Å—è —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü—Ä–∏—á–∏–Ω–∞**: `supabase.auth.admin.deleteUser()` —Ç—Ä–µ–±—É–µ—Ç service_role –∫–ª—é—á

**–†–µ—à–µ–Ω–∏–µ**: –õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å service_role –∫–ª—é—á –Ω–∞ backend, –ª–∏–±–æ —Å–æ–∑–¥–∞—Ç—å RPC —Ñ—É–Ω–∫—Ü–∏—é —Å SECURITY DEFINER

---

## üìù Checklist –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- [ ] –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –≤—Å–µ 5 –º–∏–≥—Ä–∞—Ü–∏–π –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
- [ ] Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ (–æ—Ç–∫–ª—é—á–µ–Ω–æ –¥–ª—è dev –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã templates –¥–ª—è prod)
- [ ] RLS –æ—Ç–∫–ª—é—á–µ–Ω –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã profiles
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/admin/users` - –≤–∏–¥–Ω—ã –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- [ ] –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–µ—Ä–µ–∑ UI
- [ ] –ò–∑–º–µ–Ω–µ–Ω–∞ —Ä–æ–ª—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–∞–∑–Ω—ã–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
- [ ] CLAUDE.md –æ–±–Ω–æ–≤–ª–µ–Ω (Authentication: Enabled)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –º–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–æ–ª–µ–π

---

## üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Session Timeout

1. **Authentication** ‚Üí **Settings**
2. **JWT expiry** - –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3600 —Å–µ–∫—É–Ω–¥ = 1 —á–∞—Å)
3. **Refresh token rotation** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Password Requirements

1. **Authentication** ‚Üí **Policies**
2. **Minimum password length** - –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
3. **Password strength** - –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è

### –í–∫–ª—é—á–µ–Ω–∏–µ Multi-Factor Authentication (MFA)

1. **Authentication** ‚Üí **Settings** ‚Üí **Multi-Factor Authentication**
2. –í–∫–ª—é—á–∏—Ç—å **TOTP** (Time-based One-Time Password)
3. –û–±–Ω–æ–≤–∏—Ç—å UI –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ MFA

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Supabase Auth Documentation](https://supabase.com/docs/guides/auth)
- [Row Level Security (RLS)](https://supabase.com/docs/guides/auth/row-level-security)
- [Managing User Roles](https://supabase.com/docs/guides/auth/managing-user-data)

---

## üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Supabase Dashboard ‚Üí Logs
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Browser Console (F12)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab –¥–ª—è –æ—à–∏–±–æ–∫ API
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
