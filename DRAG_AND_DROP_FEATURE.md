# Функционал Drag-and-Drop для связывания материалов с работами

## Обзор
Реализован механизм связывания материалов с работами через перетаскивание (drag-and-drop) на странице /boq.

## Ключевые изменения

### 1. Удалено поле объема для материалов
- При добавлении материала больше не требуется указывать объем
- Объем материала рассчитывается автоматически при связывании с работой
- Для материалов остаются поля: наименование, единица измерения, цена, коэффициент расхода, коэффициент перевода

### 2. Реализован механизм drag-and-drop
- Материалы можно перетаскивать на работы для создания связи
- При перетаскивании автоматически создается связь между материалом и работой
- Визуальная индикация при перетаскивании (подсветка целевой работы)

### 3. Автоматический расчет объема материала
Формула расчета:
```
Объем материала = manual_volume × consumption_coefficient × conversion_coefficient
```
Где:
- `manual_volume` - объем работы из позиции (вводится вручную)
- `consumption_coefficient` - коэффициент расхода материала
- `conversion_coefficient` - коэффициент перевода единиц измерения

### 4. Удалена кнопка "Связать с материалами"
- Больше нет необходимости в отдельной кнопке для связывания
- Связывание происходит интуитивно через перетаскивание

## Как использовать

1. **Добавление работы:**
   - Выберите тип "Работы"
   - Укажите наименование, единицу измерения, объем и цену
   - Нажмите "Добавить"

2. **Добавление материала:**
   - Выберите тип "Материалы"
   - Укажите наименование, единицу измерения и цену
   - При необходимости укажите коэффициент расхода и коэффициент перевода
   - Нажмите "Добавить"

3. **Связывание материала с работой:**
   - Найдите добавленный материал в списке (у него будет иконка перетаскивания)
   - Перетащите материал на нужную работу
   - Связь создастся автоматически
   - Объем материала будет рассчитан на основе объема работы и коэффициентов

4. **Просмотр связанных материалов:**
   - Под каждой работой отображаются все связанные с ней материалы
   - Показывается рассчитанный объем каждого материала

## Технические детали

### Использованные библиотеки
- `@dnd-kit/core` - основная библиотека для drag-and-drop
- `@dnd-kit/sortable` - поддержка сортировки элементов
- `@dnd-kit/utilities` - вспомогательные утилиты

### Новые компоненты
- `SortableBOQItem.tsx` - компонент для перетаскиваемых элементов BOQ
- `DraggableBOQItem.tsx` - альтернативный компонент для перетаскивания (опциональный)

### Обновленные компоненты
- `TenderBOQManagerNew.tsx` - основной компонент с поддержкой drag-and-drop
- `materialCalculations.ts` - утилиты для расчета объемов материалов

### API изменения
- При создании связи используется `workMaterialLinksApi.createLink()`
- Объем материала рассчитывается на клиенте с помощью `calculateMaterialVolume()`
- Связи обновляются через `updateLinkWithCalculatedVolume()`

## Преимущества нового подхода

1. **Интуитивность** - перетаскивание более понятно пользователям
2. **Скорость** - быстрее создавать связи между элементами
3. **Автоматизация** - объемы рассчитываются автоматически
4. **Визуальная обратная связь** - сразу видно, какие материалы к каким работам привязаны
5. **Меньше ошибок** - нет необходимости вручную вводить объемы материалов