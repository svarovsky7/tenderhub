<!DOCTYPE html>
<html>
<head>
  <title>Создать тестовый Excel для импорта затрат</title>
  <meta charset="utf-8">
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
    }
    button {
      background-color: #1890ff;
      color: white;
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 10px;
    }
    button:hover {
      background-color: #40a9ff;
    }
    .info {
      background-color: #f0f2f5;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <h1>Генератор тестовых Excel файлов для импорта затрат</h1>
  
  <div class="info">
    <h3>Доступные файлы для генерации:</h3>
    <ul>
      <li><strong>Малый тест</strong> - 20 записей для быстрой проверки</li>
      <li><strong>Средний тест</strong> - 100 записей для проверки производительности</li>
      <li><strong>Большой тест</strong> - 500 записей для стресс-теста</li>
    </ul>
  </div>
  
  <button id="small">Создать малый тест (20 записей)</button>
  <button id="medium">Создать средний тест (100 записей)</button>
  <button id="large">Создать большой тест (500 записей)</button>
  
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
  <script>
    // Генерация данных
    function generateData(size) {
      const data = [
        ['№', 'Категория', 'Ед.изм. категории', 'Вид затрат', 'Ед.изм. детали', 'Локализация']
      ];
      
      const categories = [
        { name: 'Материалы', unit: 'т', items: [
          { name: 'Цемент М500', unit: 'кг', loc: 'Россия' },
          { name: 'Арматура А3 12мм', unit: 'т', loc: 'Россия' },
          { name: 'Песок речной', unit: 'м³', loc: 'Местный' },
          { name: 'Щебень 20-40', unit: 'м³', loc: 'Местный' },
          { name: 'Кирпич М150', unit: 'шт', loc: 'Россия' }
        ]},
        { name: 'Работы', unit: 'м²', items: [
          { name: 'Монтаж опалубки', unit: 'м²', loc: '' },
          { name: 'Бетонирование', unit: 'м³', loc: '' },
          { name: 'Армирование', unit: 'т', loc: '' },
          { name: 'Кладка кирпича', unit: 'м³', loc: '' },
          { name: 'Штукатурные работы', unit: 'м²', loc: '' }
        ]},
        { name: 'Машины и механизмы', unit: 'маш-час', items: [
          { name: 'Автокран 25т', unit: 'час', loc: '' },
          { name: 'Бетононасос', unit: 'час', loc: '' },
          { name: 'Компрессор', unit: 'час', loc: '' },
          { name: 'Экскаватор', unit: 'час', loc: '' },
          { name: 'Бульдозер', unit: 'час', loc: '' }
        ]},
        { name: 'Транспорт', unit: 'т-км', items: [
          { name: 'Автосамосвал 20т', unit: 'рейс', loc: 'Местный' },
          { name: 'Бортовой автомобиль 10т', unit: 'час', loc: 'Местный' },
          { name: 'Тягач с полуприцепом', unit: 'рейс', loc: 'Местный' }
        ]},
        { name: 'Инструменты', unit: 'шт', items: [
          { name: 'Молоток', unit: 'шт', loc: 'Китай' },
          { name: 'Лопата', unit: 'шт', loc: 'Россия' },
          { name: 'Отвертка', unit: 'шт', loc: 'Германия' }
        ]}
      ];
      
      let itemCount = 0;
      let catNum = 1;
      
      for (const cat of categories) {
        if (itemCount >= size) break;
        
        // Добавляем категорию
        data.push([catNum, cat.name, cat.unit, '', '', '']);
        itemCount++;
        
        // Добавляем элементы категории
        for (const item of cat.items) {
          if (itemCount >= size) break;
          data.push(['', '', '', item.name, item.unit, item.loc]);
          itemCount++;
        }
        
        // Добавляем пустую строку между категориями
        if (itemCount < size) {
          data.push(['', '', '', '', '', '']);
          itemCount++;
        }
        
        catNum++;
      }
      
      // Добавляем дополнительные записи если нужно больше
      while (itemCount < size) {
        const catIndex = Math.floor(Math.random() * categories.length);
        const cat = categories[catIndex];
        const itemIndex = Math.floor(Math.random() * cat.items.length);
        const item = cat.items[itemIndex];
        
        // Модифицируем название для уникальности
        const uniqueName = `${item.name} (вариант ${Math.floor(Math.random() * 100)})`;
        data.push(['', '', '', uniqueName, item.unit, item.loc]);
        itemCount++;
      }
      
      return data;
    }
    
    // Создание файла
    function createFile(size, filename) {
      const data = generateData(size);
      
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet(data);
      
      // Устанавливаем ширину колонок
      ws['!cols'] = [
        { wch: 5 },   // №
        { wch: 25 },  // Категория
        { wch: 20 },  // Ед.изм. категории
        { wch: 35 },  // Вид затрат
        { wch: 20 },  // Ед.изм. детали
        { wch: 15 }   // Локализация
      ];
      
      XLSX.utils.book_append_sheet(wb, ws, 'Затраты на строительство');
      XLSX.writeFile(wb, filename);
      
      alert(`Файл "${filename}" создан! Содержит ${size} записей. Проверьте папку загрузок.`);
    }
    
    // Обработчики кнопок
    document.getElementById('small').addEventListener('click', function() {
      createFile(20, 'test_costs_small_20.xlsx');
    });
    
    document.getElementById('medium').addEventListener('click', function() {
      createFile(100, 'test_costs_medium_100.xlsx');
    });
    
    document.getElementById('large').addEventListener('click', function() {
      createFile(500, 'test_costs_large_500.xlsx');
    });
  </script>
</body>
</html>